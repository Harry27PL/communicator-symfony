services:
    em:
        alias:      doctrine.orm.entity_manager

    ##

    user.repository:
        class:      Repository\UserRepository
        arguments:  [@em, @security.encoder_factory]

    user.register:
        class:      Service\User\UserRegister
        arguments:  [@user.repository, @user.logAs]

    user.logAs:
        class:      Service\User\UserLogAs
        arguments:  [@session, @security.context]

    ##

    call.repository:
        class:      Repository\CallRepository
        arguments:  [@em]

    ##

    phone.connection:
        abstract:   true
        arguments:  [@faye, @call.repository]

    phone.connection.offer:
        class:      Service\Phone\Connection\ConnectionOffer
        parent:     phone.connection

    phone.connection.answer:
        class:      Service\Phone\Connection\ConnectionAnswer
        parent:     phone.connection

    phone.connection.complete:
        class:      Service\Phone\Connection\ConnectionComplete
        parent:     phone.connection

    phone.connection.ICECandidate:
        class:      Service\Phone\Connection\ConnectionICECandidate
        parent:     phone.connection

    ##

    faye:
        class:      Service\Faye\Faye
        arguments:  [@user.repository]

    ##

    date.twig.extension:
        class:        TwigExtensions\Date
        arguments:    [@translator]
        tags:
            -  { name: twig.extension }

    form.twig.extension:
        class:        TwigExtensions\Form
        tags:
            -  { name: twig.extension }

    avatar.twig.extension:
        class:        TwigExtensions\Avatar
        tags:
            -  { name: twig.extension }

    autop.twig.extension:
        class:        TwigExtensions\Autop
        tags:
            -  { name: twig.extension }
